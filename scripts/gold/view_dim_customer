---รวมproduct table เป็น 1

SELECT [cst_id]
      ,[cst_key]
      ,[cst_firstname]
      ,[cst_lastname]
      ,[cst_marital_status]
      ,[cst_gndr]
      ,[cst_create_date]
      ,a.bdate
      ,a.gen
      ,b.cntry
  FROM [DataWarehouse].[silver].[crm_cust_info] m
  left join silver.erp_cust_az12 a
  on m.cst_key = a.cid
  left join silver.erp_loc_a101 b
  on m.cst_key = b.cid

 --- join เสจเชค dup หลังจอย

select cst_id, count(*) from(
 SELECT [cst_id]
      ,[cst_key]
      ,[cst_firstname]
      ,[cst_lastname]
      ,[cst_marital_status]
      ,[cst_gndr]
      ,[cst_create_date]
      ,a.bdate
      ,a.gen
      ,b.cntry
  FROM [DataWarehouse].[silver].[crm_cust_info] m
  left join silver.erp_cust_az12 a
  on m.cst_key = a.cid
  left join silver.erp_loc_a101 b
  on m.cst_key = b.cid
  )t group by cst_id
  having count(*)>1


---ยุบ col ทีมีซ้ำ ให้เหลือ 1
---compare both 2 cols
 SELECT distinct
      [cst_gndr]
      ,a.gen
  FROM [DataWarehouse].[silver].[crm_cust_info] m
  left join silver.erp_cust_az12 a
  on m.cst_key = a.cid
  left join silver.erp_loc_a101 b
  on m.cst_key = b.cid
  order by 1,2

---rich col
 SELECT distinct
      [cst_gndr]
      ,a.gen
      , case when cst_gndr != 'n/a' then cst_gndr
      else coalesce(gen, 'n/a')
      end new_gen
  FROM [DataWarehouse].[silver].[crm_cust_info] m
  left join silver.erp_cust_az12 a
  on m.cst_key = a.cid
  left join silver.erp_loc_a101 b
  on m.cst_key = b.cid
  order by 1,2


  ---create view in gold layer
  create view gold.dim_customers as
  SELECT 
      ROW_NUMBER() over(order by cst_id) as customer_key
      ,[cst_id] customer_id
      ,[cst_key] customer_number
      ,[cst_firstname] firstname
      ,[cst_lastname] lastname
      ,b.cntry country
      ,[cst_marital_status] marital_status
      , case when cst_gndr != 'n/a' then cst_gndr
      else coalesce(gen, 'n/a')
      end gener
      ,a.bdate birthdate
      ,[cst_create_date] create_date
  FROM [DataWarehouse].[silver].[crm_cust_info] m
  left join silver.erp_cust_az12 a
  on m.cst_key = a.cid
  left join silver.erp_loc_a101 b
  on m.cst_key = b.cid

  ---
  select * from gold.dim_customers
